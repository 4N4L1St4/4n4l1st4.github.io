---
title: "Projeto: Gerenciamento de Informa√ß√µes e Eventos de Seguran√ßa (SIEM)"
date: 2025-06-26 16:30:00 -0300
categories: [Blue Team, Nivel 1]
tags: [Teorica]
description: "Profissional em in√≠cio de carreira, respons√°vel por monitoramento b√°sico, identifica√ß√£o preliminar de amea√ßas e suporte √†s opera√ß√µes de seguran√ßa. Atua seguindo procedimentos estabelecidos e orienta√ß√µes de profissionais mais experientes, desenvolvendo habilidades t√©cnicas e conhecimento do ambiente de seguran√ßa."
image:
  path: /assets/img/PROJsiem.png
  alt: Ilustra√ß√£o de um computador moderno com elementos de c√≥digo e processamento
---

# üîµ Blue Team: Introdu√ß√£o ao SIEM (conceito, uso, eventos)

Um dos principais aliados do Blue Team na detec√ß√£o de amea√ßas √© o **SIEM** ‚Äì uma ferramenta que centraliza, organiza e analisa eventos de seguran√ßa. Dominar o uso do SIEM √© essencial para prevenir, detectar e responder a incidentes em tempo real.

O SIEM √© o radar do Blue Team ‚Äì sem ele, voc√™ est√° voando √†s cegas.

## üß† O que √© um SIEM?

**SIEM** significa *Security Information and Event Management*.  
√â uma solu√ß√£o que coleta, armazena, correlaciona e analisa **eventos de seguran√ßa** gerados por dispositivos, sistemas e aplica√ß√µes.


## üéØ Objetivos principais do SIEM:

- **Centralizar logs** de diversos dispositivos (servidores, firewalls, endpoints, etc.)  
- **Detectar amea√ßas em tempo real** por meio de regras de correla√ß√£o  
- **Gerar alertas de seguran√ßa** baseados em comportamentos an√¥malos  
- **Apoiar investiga√ß√µes e resposta a incidentes**  
- **Cumprir requisitos de auditoria e conformidade**


## üóÇÔ∏è Fontes comuns de eventos no SIEM

Um SIEM pode receber eventos de praticamente qualquer sistema. Exemplos:

- **Windows:** eventos de logon (4624, 4625), cria√ß√£o de processo (4688)  
- **Linux:** logs de autentica√ß√£o (`/var/log/auth.log`), sudo, SSH  
- **Firewalls:** conex√µes permitidas/bloqueadas, NAT, regras violadas  
- **EDR/Antiv√≠rus:** detec√ß√£o de malware, execu√ß√£o suspeita  
- **Servi√ßos em nuvem:** AWS CloudTrail, Azure Monitor, Google Cloud Logging  
- **Aplica√ß√µes:** falhas de autentica√ß√£o, a√ß√µes cr√≠ticas de usu√°rios  


## üîç Exemplo de evento no SIEM (Windows)

```json
{
  "EventID": 4625,
  "AccountName": "admin",
  "LogonType": 3,
  "IPAddress": "10.10.10.15",
  "Status": "0xC000006A",
  "TimeCreated": "2025-06-26T22:15:00"
}
```

Esse evento indica uma **tentativa de logon falha** em uma conex√£o de rede (tipo 3), vinda do IP `10.10.10.15`.


## ‚öôÔ∏è Como o SIEM funciona (fluxo geral)

1. **Coleta:** agentes ou forwarders enviam logs dos dispositivos  
2. **Normaliza√ß√£o:** dados brutos s√£o estruturados em um formato comum  
3. **Indexa√ß√£o:** eventos s√£o armazenados para consulta r√°pida  
4. **Correla√ß√£o:** regras detectam padr√µes de ataque ou anomalias  
5. **Alerta:** notifica√ß√µes s√£o geradas com base nas regras  
6. **An√°lise:** analistas investigam eventos por meio de dashboards e buscas  
7. **Resposta:** a√ß√µes manuais ou autom√°ticas s√£o iniciadas


## üìå Exemplos de uso pr√°tico no Blue Team

- Detectar **tentativas de brute-force** com m√∫ltiplos eventos 4625  
- Identificar **movimenta√ß√£o lateral** por logons RDP fora do padr√£o  
- Monitorar **execu√ß√µes de comandos perigosos** (ex: PowerShell + base64)  
- Correlacionar logs de firewall com eventos de endpoint  
- Criar alertas baseados em **hor√°rios an√¥malos de login** ou **usu√°rios privilegiados**


## üõ†Ô∏è Exemplos de ferramentas SIEM

| Nome         | Tipo        | Coment√°rio                                 |
|--------------|-------------|--------------------------------------------|
| **Splunk**   | Comercial   | Muito robusto, flex√≠vel e escal√°vel        |
| **ELK Stack**| Open-source | Elastic + Logstash + Kibana                |
| **Wazuh**    | Open-source | SIEM com foco em seguran√ßa e compliance    |
| **Microsoft Sentinel** | Cloud | Integrado ao Azure, f√°cil de automatizar |
| **Graylog**  | Open-source | Interface simples e eficaz                 |


## üß† Dica para iniciantes:

Comece aprendendo a **buscar eventos espec√≠ficos**, como:

- `EventID=4625` ‚Üí logons falhos  
- `cmd.exe` OU `powershell.exe` ‚Üí execu√ß√£o de comandos  
- `src_ip:10.0.0.* AND dst_port:3389` ‚Üí acessos RDP

Aos poucos, avance para **regras de correla√ß√£o personalizadas**, alertas automatizados e uso de dashboards.

# üîµ Blue Team: Treinamento ‚Äì Splunk Fundamentals 1 (M√≥dulos 1 e 2)

O curso **Splunk Fundamentals 1** √© a porta de entrada oficial para o uso do Splunk, uma das ferramentas de SIEM mais poderosas do mercado. Os **m√≥dulos 1 e 2** apresentam os conceitos b√°sicos de uso da plataforma, essenciais para analistas de Blue Team.

Buscar √© o novo modo de investigar ‚Äì e no Splunk, a linguagem √© poder.

## üéØ Objetivo do curso

Capacitar o aluno a navegar pela interface do Splunk, executar buscas b√°sicas, usar comandos essenciais e compreender a estrutura dos dados.  

O conte√∫do √© gratuito e online, dispon√≠vel na [Splunk Education](https://www.splunk.com/en_us/training.html).

## üìò M√≥dulo 1 ‚Äì Introdu√ß√£o ao Splunk

### üîπ O que √© Splunk?

O Splunk √© uma plataforma que permite coletar, indexar, pesquisar, visualizar e correlacionar dados de qualquer fonte (logs, m√©tricas, eventos). Ele √© amplamente utilizado para:

- Monitoramento de seguran√ßa (SIEM)  
- Observabilidade de sistemas  
- Resposta a incidentes  
- Detec√ß√£o de amea√ßas  

### üß± Componentes principais:

- **Indexer:** onde os dados s√£o armazenados e indexados  
- **Search Head:** onde o usu√°rio faz buscas e visualiza√ß√µes  
- **Forwarder:** envia dados para o Indexer  
- **Deployment Server:** gerencia configura√ß√µes em larga escala  

### üß≠ Navegando pela interface:

- **Search & Reporting:** painel principal de buscas  
- **Data Summary:** visualiza hosts, fontes e tipos de dados  
- **Apps:** m√≥dulos adicionais como Enterprise Security  
- **Settings:** configura√ß√µes de dados, usu√°rios e permiss√µes  

## üìò M√≥dulo 2 ‚Äì Executando Buscas no Splunk

### üîé Sintaxe b√°sica de busca:

As buscas no Splunk come√ßam com a palavra `search` (opcional) e utilizam filtros por palavras-chave, campos e comandos.  

**Exemplo simples:**

```spl
index=main error
```

Retorna eventos no √≠ndice `main` que contenham a palavra "error".


### üóÉÔ∏è Filtros comuns:

- `index=` ‚Üí especifica qual √≠ndice de dados usar  
- `source=` ‚Üí arquivo ou origem dos dados  
- `sourcetype=` ‚Üí tipo de dado (ex: `WinEventLog:Security`)  
- `host=` ‚Üí hostname de onde veio o log  

**Exemplo:**

```spl
index=ossec source="/var/log/auth.log" action=denied
```

### üß† Dica: Usar o bot√£o **"Data Summary"** para descobrir os √≠ndices, fontes e tipos mais usados antes de buscar.

### üìä Visualiza√ß√µes b√°sicas:

Ap√≥s executar uma busca, o Splunk permite criar gr√°ficos a partir dos resultados com comandos como:

```spl
index=firewall action=blocked | stats count by src_ip
```
Esse comando conta quantas vezes cada IP de origem foi bloqueado.


### üîß Operadores √∫teis:

| Operador     | Descri√ß√£o                         |
|--------------|-----------------------------------|
| `AND`        | Ambos os termos devem existir     |
| `OR`         | Um ou outro pode existir          |
| `NOT`        | Exclui eventos com esse termo     |
| `=`          | Busca por campo igual a valor     |
| `!=`         | Campo diferente do valor          |

## üß† Para praticar:

- Use os **datasets de demonstra√ß√£o** dispon√≠veis na inst√¢ncia Splunk do curso  
- Crie buscas simples por falhas de login, comandos executados ou IPs suspeitos  
- Experimente filtros com `index=`, `source=`, `sourcetype=`, `host=`

## üöÄ Pr√≥ximos m√≥dulos

Nos m√≥dulos seguintes, o curso aborda:

- Uso avan√ßado do `stats`, `table`, `timechart`  
- Cria√ß√£o de dashboards  
- Alertas e relat√≥rios programados  

# üîµ Blue Team: Treinamento ‚Äì Splunk Fundamentals 1 (M√≥dulos 3 e 4)

Dando continuidade ao treinamento oficial **Splunk Fundamentals 1**, os m√≥dulos 3 e 4 aprofundam o uso da linguagem de busca do Splunk, introduzindo **campos, visualiza√ß√µes, estat√≠sticas e comandos avan√ßados**. S√£o fundamentais para analistas de seguran√ßa que desejam criar investiga√ß√µes mais precisas e dashboards informativos.

Comandos como `stats` e `eval` transformam o analista de observador em investigador.

## üìò M√≥dulo 3 ‚Äì Usando Campos no Splunk

### üìå O que s√£o Campos?

Campos s√£o pares **chave:valor** extra√≠dos dos eventos (como `src_ip=10.0.0.1`, `status=404`).  
O Splunk **detecta automaticamente** campos comuns, mas voc√™ pode **criar, filtrar e manipular** campos conforme necess√°rio.

### üîç Usando campos em buscas

Voc√™ pode usar campos diretamente para refinar resultados:

```spl
index=web sourcetype=access_combined status=404
```

Isso retorna apenas eventos onde o status da requisi√ß√£o HTTP √© 404.

### üîß Campos personalizados (rex, eval)

Voc√™ pode criar novos campos tempor√°rios durante a busca:

#### üìå `eval` ‚Üí Cria campos com l√≥gica simples

```spl
... | eval risco=if(status==500, "alto", "baixo")
```

#### üìå `rex` ‚Üí Extrai campos usando express√µes regulares

```spl
... | rex field=_raw "user=(?<username>\w+)"
```

Esse exemplo cria um campo chamado `username` extra√≠do do conte√∫do de `_raw`.

### üß∞ Comando `fields`

Usado para **mostrar ou ocultar** campos no resultado:

```spl
... | fields username, src_ip
```

## üìò M√≥dulo 4 ‚Äì Usando Estat√≠sticas e Visualiza√ß√µes

### üìä Comando `stats`

O `stats` permite agregar dados e gerar resumos estat√≠sticos.  
Exemplo: contar eventos por endere√ßo IP:

```spl
index=firewall action=blocked | stats count by src_ip
```

### üìä Outros comandos estat√≠sticos:

| Comando          | Fun√ß√£o                          |
|------------------|----------------------------------|
| `count`          | Conta eventos                   |
| `sum`            | Soma valores num√©ricos          |
| `avg`            | M√©dia                           |
| `min` / `max`    | M√≠nimo / M√°ximo                 |
| `dc`             | Distinct count (valores √∫nicos) |

### üßÆ Exemplo com m√∫ltiplas m√©tricas:

```spl
index=web status=* | stats count, dc(clientip) by status
```

Conta o n√∫mero total de eventos e o n√∫mero de IPs √∫nicos por status HTTP.


### üìà Visualiza√ß√µes no Splunk

Voc√™ pode transformar buscas em **gr√°ficos interativos**, como:

- **Barras** (por quantidade)  
- **Pizza** (por distribui√ß√£o)  
- **Linha do tempo** (eventos ao longo do tempo)  
- **Mapa geogr√°fico** (com dados de localiza√ß√£o)  

#### Exemplo com `timechart`:

```spl
index=web status=200 | timechart count by host
```

Mostra quantos eventos 200 ocorreram ao longo do tempo, por host.

### üìã Comando `table`

Mostra os dados em forma de tabela personalizada:

```spl
index=auth action=failure | table _time, user, src_ip
```

## ‚úÖ Dicas pr√°ticas:

- Combine `stats`, `eval`, `table` e `fields` para criar visualiza√ß√µes ricas  
- Use `timechart` para an√°lises temporais (com base em `_time`)  
- Utilize `dc(field)` para identificar **diversidade** de valores, √∫til em an√°lise de comportamento  
- Evite usar `search *` (buscas amplas demais)

## üß† Exemplo de caso real:

> "Queremos descobrir os 10 IPs que mais geraram falhas de autentica√ß√£o nos √∫ltimos 7 dias."

Busca poss√≠vel:

```spl
index=auth action=failure | stats count by src_ip | sort - count | head 10
```

# üîµ Blue Team: Estudo de Casos ‚Äì Alertas Comuns em SOC

Um SOC (Security Operations Center) monitora constantemente eventos em tempo real com base em **alertas autom√°ticos**. Esses alertas s√£o essenciais para identificar atividades suspeitas, amea√ßas ou viola√ß√µes em andamento.

Este estudo de caso apresenta **exemplos reais de alertas comuns**, especialmente √∫teis para analistas de Blue Team iniciantes e intermedi√°rios.

Alertas n√£o servem para gritar, mas para informar com intelig√™ncia.

## üö® 1. Tentativas de Brute-force

### üéØ Objetivo:
Detectar **m√∫ltiplas falhas de autentica√ß√£o** em um curto per√≠odo de tempo.

### üß† L√≥gica do alerta:
- Muitos eventos de falha de login (Windows Event ID 4625)  
- Mesma origem IP ou mesmo usu√°rio  
- Curto intervalo de tempo

### üïµÔ∏è Exemplo em Splunk:

```spl
index=wineventlog EventCode=4625 
| stats count by src_ip, user 
| where count > 10
```

Esse alerta detecta IPs ou usu√°rios com mais de 10 falhas de login.

## üö® 2. Execu√ß√£o de Comandos Suspeitos

### üéØ Objetivo:
Identificar execu√ß√µes de comandos ou scripts potencialmente perigosos.

### üß† L√≥gica do alerta:
- Detec√ß√£o de `cmd.exe`, `powershell.exe`, `wscript.exe`  
- Comandos com uso de `base64`, `invoke`, `download`, `encodedcommand`

### üïµÔ∏è Exemplo em Splunk:

```spl
index=windows EventCode=4688 
| where CommandLine LIKE "%powershell%" AND CommandLine LIKE "%base64%"
```

Esse alerta flagra o uso de PowerShell com codifica√ß√£o base64 (comum em malware).

## üö® 3. Novo Usu√°rio Criado em Hor√°rio Incomum

### üéØ Objetivo:
Detectar cria√ß√£o de contas suspeitas fora do hor√°rio comercial.

### üß† L√≥gica do alerta:
- Event ID 4720 (novo usu√°rio)  
- Hor√°rio entre 00:00 e 06:00

### üïµÔ∏è Exemplo em Splunk:

```spl
index=wineventlog EventCode=4720 
| eval hour=strftime(_time,"%H") 
| where hour < 6
```

Esse alerta aponta cria√ß√µes de usu√°rio entre meia-noite e 6h da manh√£.

## üö® 4. Atividade Remota N√£o Comum (ex: RDP fora do padr√£o)

### üéØ Objetivo:
Detectar conex√µes remotas an√¥malas ou fora do pa√≠s esperado.

### üß† L√≥gica do alerta:
- Logons via RDP (LogonType=10)  
- Pa√≠s/IP fora do perfil da empresa

### üïµÔ∏è Exemplo:

```spl
index=wineventlog EventCode=4624 LogonType=10 
| iplocation src_ip 
| search Country!="Brazil"
```

Esse alerta detecta acessos RDP de fora do pa√≠s.

## üö® 5. Execu√ß√£o de Bin√°rios Raros (Living off the Land)

### üéØ Objetivo:
Detectar o uso de bin√°rios do sistema que podem ser abusados (LOLBins).

### ‚ö†Ô∏è Exemplos:
- `mshta.exe`, `certutil.exe`, `regsvr32.exe`, `rundll32.exe`

### üïµÔ∏è Exemplo de alerta:

```spl
index=windows EventCode=4688 
| search NewProcessName IN ("*mshta.exe", "*certutil.exe", "*regsvr32.exe")
```

Esses processos s√£o frequentemente usados em ataques fileless.

## üõ°Ô∏è Dicas de Blue Team:

- Automatize esses alertas via SIEM para resposta r√°pida  
- Crie **baselines normais** para comparar com desvios  
- Utilize blocos como `threat_intel`, `lookup`, `geoip` para enriquecer alertas  
- Combine logs de endpoints, rede e identidade para mais precis√£o

## ‚úÖ Conclus√£o

Dominar alertas comuns permite que o analista:

- üïí Ganhe agilidade na triagem de incidentes  
- üö© Reduza falsos positivos com ajustes finos  
- üìà Fortale√ßa regras com base em observa√ß√µes reais  
- üí° Evolua o SOC para um modelo mais inteligente e preditivo

# üîµ Blue Team: Simula√ß√£o com ELK Stack ‚Äì Ingest√£o de Logs e Buscas

O **ELK Stack** (Elasticsearch, Logstash e Kibana) √© uma das ferramentas mais usadas para centraliza√ß√£o de logs, buscas e visualiza√ß√µes em ambientes de seguran√ßa.  
Essa simula√ß√£o mostra como fazer uma ingest√£o b√°sica de logs e executar buscas √∫teis para o Blue Team.

Com ELK, at√© um simples log do sistema se transforma em intelig√™ncia de seguran√ßa.

## üì¶ O que √© o ELK Stack?

- **Elasticsearch:** mecanismo de busca e armazenamento dos dados indexados  
- **Logstash:** pipeline de coleta, transforma√ß√£o e envio de logs  
- **Kibana:** interface web para visualiza√ß√£o e an√°lise dos dados  

## üõ†Ô∏è Ambiente da simula√ß√£o

- ELK local ou via Docker  
- Logstash configurado para receber logs de arquivos locais (ex: `/var/log/auth.log`)  
- Kibana acess√≠vel em `http://localhost:5601`  
- Logs simulados de Linux e autentica√ß√£o

## üì• Etapa 1 ‚Äì Ingest√£o de logs com Logstash

O Logstash utiliza um **pipeline** com tr√™s se√ß√µes: `input`, `filter` e `output`.

### üìÑ Exemplo de pipeline (`logstash.conf`):

```bash
input {
  file {
    path => "/var/log/auth.log"
    start_position => "beginning"
  }
}

filter {
  grok {
    match => { "message" => "%{SYSLOGTIMESTAMP:timestamp} %{HOSTNAME:host} sshd.*Failed password for %{USER:user} from %{IP:src_ip}" }
  }
}

output {
  elasticsearch {
    hosts => ["http://localhost:9200"]
    index => "linux-auth"
  }
  stdout { codec => rubydebug }
}
```

Esse pipeline l√™ falhas de login SSH e envia para o √≠ndice `linux-auth`.

## üìä Etapa 2 ‚Äì Visualizando no Kibana

1. Acesse o **Kibana** em `http://localhost:5601`  
2. V√° em **Stack Management > Index Patterns**  
3. Crie um padr√£o com o √≠ndice `linux-auth*`  
4. V√° em **Discover** para ver os eventos em tempo real

## üîç Etapa 3 ‚Äì Buscas √∫teis para Blue Team

### ‚ùó Falhas de login SSH

```kibana
message: "Failed password"
```

### üìà Quantidade de falhas por IP

```kibana
message: "Failed password"
| stats count by src_ip
```

### üîé IPs com m√∫ltiplas tentativas

```kibana
message: "Failed password"
| stats count by src_ip
| where count > 5
```

### ‚è±Ô∏è Tentativas fora do hor√°rio comercial

```kibana
message: "Failed password"
| eval hour = date_format(timestamp, "H")
| where hour < 6 OR hour > 20
```

> As buscas no Kibana podem ser feitas com filtros simples ou usando **Lens** e **Visualize** para dashboards.

## üß† Dicas pr√°ticas:

- Use **grok** para estruturar logs sem formata√ß√£o (ex: logs brutos do Linux)  
- Configure **alertas** com o Kibana Alerts (Watcher) ou Elastic Security  
- Combine com **beats** (ex: Filebeat) para facilitar a coleta de logs remotos  
- Visualize falhas e sucessos de login, execu√ß√µes de comando e mudan√ßas de usu√°rios

## ‚úÖ Conclus√£o

Com o ELK Stack, √© poss√≠vel construir uma solu√ß√£o poderosa e gratuita para:

- Centralizar logs de servidores, firewalls e endpoints  
- Investigar tentativas de intrus√£o em tempo real  
- Criar alertas e relat√≥rios automatizados  
- Apoiar investiga√ß√µes forenses com base hist√≥rica

# üîµ Blue Team: Estudo de Logs em SIEM (Sysmon, DNS, Proxy, Endpoint)

O sucesso da an√°lise de seguran√ßa no SIEM depende da **qualidade dos logs** que ele recebe. Para que o Blue Team consiga detectar comportamentos suspeitos e responder a incidentes de forma eficaz, √© essencial compreender os principais tipos de log e o que cada um pode revelar.

Este guia cobre os logs mais importantes no contexto de um SIEM: **Sysmon, DNS, Proxy e Endpoint**.

Quem domina os logs, controla a narrativa de um incidente.

---

## üß† O que √© log no contexto de SIEM?

Logs s√£o registros de atividades geradas por sistemas, aplicativos, dispositivos de rede e endpoints. O SIEM coleta, indexa e correlaciona esses eventos para:

- Identificar comportamentos an√¥malos
- Gerar alertas de seguran√ßa
- Ajudar na resposta a incidentes
- Facilitar investiga√ß√µes forenses

---

## üõ†Ô∏è 1. Sysmon (System Monitor)

O Sysmon √© uma ferramenta da Microsoft que registra eventos detalhados sobre o sistema operacional. Ele √© instalado como um servi√ßo e produz logs no canal de eventos do Windows.

### Eventos relevantes no SIEM:

| Event ID | Descri√ß√£o                            |
|----------|--------------------------------------|
| 1        | Cria√ß√£o de processo                  |
| 3        | Conex√£o de rede                      |
| 7        | Cria√ß√£o de imagem carregada (DLLs)   |
| 11       | Cria√ß√£o de arquivo                   |
| 13       | Modifica√ß√£o de chave do Registro     |

### Utiliza√ß√£o pr√°tica:

- Identificar execu√ß√£o de PowerShell suspeito
- Detectar movimenta√ß√£o lateral via processos remotos
- Mapear conex√µes de rede iniciadas por malware

---

## üåê 2. Logs de DNS

Os logs de DNS mostram quais dom√≠nios foram consultados por sistemas e usu√°rios, funcionando como uma janela para os alvos de comunica√ß√£o na rede.

### Dados comuns em logs DNS:

- Nome do dom√≠nio consultado
- IP de origem (host)
- Timestamp da requisi√ß√£o
- Resposta do servidor

### Utiliza√ß√£o pr√°tica:

- Detectar conex√µes com dom√≠nios maliciosos (C2, phishing)
- Identificar tunneling de dados via DNS
- Criar listas de bloqueio a partir de IOCs

---

## üåç 3. Logs de Proxy

Proxies interceptam o tr√°fego web, e seus logs s√£o ricos em dados de navega√ß√£o. Um SIEM bem alimentado com logs de proxy √© fundamental para monitorar acesso a conte√∫do suspeito.

### Campos √∫teis:

- URL acessada
- M√©todo HTTP (GET, POST, etc.)
- C√≥digo de resposta (200, 403, etc.)
- IP/usu√°rio de origem
- Volume de dados trafegado

### Utiliza√ß√£o pr√°tica:

- Detectar acesso a dom√≠nios suspeitos ou proibidos
- Identificar comportamento an√¥malo de navega√ß√£o
- Correlacionar usu√°rios com exfiltra√ß√£o de dados

---

## üíª 4. Logs de Endpoint (EDR/Antiv√≠rus)

Os endpoints s√£o a linha de frente contra amea√ßas. Ferramentas de EDR (como CrowdStrike, SentinelOne, Defender for Endpoint) geram eventos sobre comportamento de processos, arquivos, usu√°rios e rede.

### Tipos de eventos:

- Execu√ß√£o de bin√°rios
- Acesso/modifica√ß√£o de arquivos
- Detec√ß√£o de malware
- Eleva√ß√£o de privil√©gios
- Persist√™ncia suspeita

### Utiliza√ß√£o pr√°tica:

- Detectar ransomware ou execu√ß√£o de scripts automatizados
- Correlacionar a√ß√µes maliciosas com o usu√°rio respons√°vel
- Monitorar atividade p√≥s-comprometimento

---

## üß© Correlacionando logs no SIEM

O verdadeiro poder de um SIEM est√° na correla√ß√£o entre fontes diferentes. Por exemplo:

- Sysmon registra a execu√ß√£o de `powershell.exe`
- DNS mostra conex√£o com dom√≠nio suspeito
- Proxy indica upload para servi√ßo externo
- Endpoint alerta para comportamento an√¥malo do processo

Essa sequ√™ncia pode indicar exfiltra√ß√£o de dados via PowerShell e DNS tunneling.

---

## ‚úÖ Conclus√£o

Um bom analista de Blue Team precisa dominar a leitura e interpreta√ß√£o dos logs mais comuns em ambientes corporativos. Entender o **contexto** e o **valor anal√≠tico** de cada tipo de log permite criar alertas eficazes, acelerar investiga√ß√µes e melhorar a postura defensiva da organiza√ß√£o.

# Instala√ß√£o de ambiente Wazuh

Bem-vindo √† se√ß√£o dedicada √† instala√ß√£o do Wazuh em um ambiente de produ√ß√£o. Esta parte detalhar√° os passos necess√°rios para configurar um sistema robusto e escal√°vel, garantindo a coleta e an√°lise eficiente de logs para detec√ß√£o de amea√ßas e conformidade.

---

### **1. Planejamento da Arquitetura**

* **Requisitos de Hardware/VM:** Dimensionamento para o ambiente de produ√ß√£o (CPU, RAM, Armazenamento - SSD/NVMe preferencial para Elasticsearch/OpenSearch).
* **Topologia de Rede:** Considera√ß√µes sobre firewalls, DMZ, sub-redes para managers, indexers e dashboards.
* **Escalabilidade:** Discuss√£o sobre arquiteturas distribu√≠das (separa√ß√£o de Manager, Indexer, Dashboard) versus all-in-one para ambientes menores.
* **Sistemas Operacionais Suportados:** Escolha do SO para cada componente (ex: CentOS, Ubuntu, Debian).

---

### **2. Pr√©-requisitos e Prepara√ß√£o do Ambiente**

* **Configura√ß√£o de Rede:** Endere√ßamento IP est√°tico, resolu√ß√£o de DNS.
* **Ajustes do Sistema Operacional:** Otimiza√ß√£o de par√¢metros do kernel (ex: `vm.max_map_count`), limites de arquivos abertos (ulimit).
* **Instala√ß√£o de Pacotes Essenciais:** Ferramentas como `wget`, `curl`, `apt-transport-https`.
* **Configura√ß√£o de Firewall (Host-based):** Abertura das portas necess√°rias para a comunica√ß√£o entre os componentes Wazuh (80/443, 1514, 55000, 9200, 5601, etc.).

---

### **3. Instala√ß√£o dos Componentes do Wazuh**

Esta se√ß√£o ser√° dividida de acordo com a arquitetura escolhida (ex: All-in-one, Distributed).

#### **3.1. Wazuh Indexer (anteriormente Elasticsearch)**

* **Instala√ß√£o de Java (JDK).**
* **Adi√ß√£o do reposit√≥rio Wazuh.**
* **Instala√ß√£o e configura√ß√£o do Wazuh Indexer:**
    * Gera√ß√£o e distribui√ß√£o de certificados SSL (fundamental para produ√ß√£o!).
    * Configura√ß√£o de clusters (para ambientes distribu√≠dos).
    * Otimiza√ß√µes de performance.

#### **3.2. Wazuh Manager**

* **Adi√ß√£o do reposit√≥rio Wazuh.**
* **Instala√ß√£o e configura√ß√£o do Wazuh Manager:**
    * Conex√£o com o Wazuh Indexer (via certificados).
    * Configura√ß√£o de regras e decodificadores personalizados (se aplic√°vel).
    * Ajustes de capacidade de agentes.

#### **3.3. Wazuh Dashboard (anteriormente Kibana)**

* **Adi√ß√£o do reposit√≥rio Wazuh.**
* **Instala√ß√£o e configura√ß√£o do Wazuh Dashboard:**
    * Integra√ß√£o com o Wazuh Indexer e Manager.
    * Configura√ß√£o de acesso HTTPS.
    * Cria√ß√£o de usu√°rios e roles.

---

### **4. Configura√ß√µes P√≥s-Instala√ß√£o e Seguran√ßa**

* **Gera√ß√£o de Agentes:** Como registrar e implantar agentes nas m√°quinas monitoradas.
* **Hardening:** Melhores pr√°ticas de seguran√ßa para os servidores Wazuh (desabilitar servi√ßos n√£o utilizados, etc.).
* **Backup e Recupera√ß√£o:** Estrat√©gias para backup dos dados do Indexer e configura√ß√µes do Manager.
* **Monitoramento da Sa√∫de do Sistema:** Como verificar o status dos servi√ßos e recursos.

---

### **5. Resolu√ß√£o de Problemas Comuns**

* Uma se√ß√£o dedicada a erros frequentes e suas solu√ß√µes.

---

### Casos de Uso SIEM

| Controle/√Årea ISO 27002                 | Risco Abordado                                          | Caso de Uso SIEM (Monitoramento/Observabilidade)                                 | Tecnologias/Dados Monitorados pelo SIEM                                        |
| :-------------------------------------- | :------------------------------------------------------ | :------------------------------------------------------------------------------- | :----------------------------------------------------------------------------- |
| **A.12.4.1 - Registro de eventos** | Falha na detec√ß√£o de atividades n√£o autorizadas ou maliciosas; N√£o conformidade com auditorias. | **Detec√ß√£o e An√°lise de Logs de Seguran√ßa** | Logs de Firewall, IDS/IPS, Proxy, Antiv√≠rus, Servidores (SO, Web, Banco de Dados), Aplica√ß√µes, Dispositivos de Rede. |
| **A.12.6.1 - Gest√£o de vulnerabilidades t√©cnicas** | Explora√ß√£o de vulnerabilidades conhecidas por atacantes; Comprometimento de sistemas. | **Monitoramento de Tentativas de Explora√ß√£o e Varreduras** | Logs de IDS/IPS, Scanners de Vulnerabilidade, Logs de Firewall (tr√°fego bloqueado para portas/servi√ßos vulner√°veis), WAF. |
| **A.9.2.5 - Revis√£o dos direitos de acesso do usu√°rio** | Ac√∫mulo de privil√©gios; Acesso indevido a sistemas ou dados por usu√°rios n√£o autorizados. | **Monitoramento de Altera√ß√µes de Privil√©gios e Cria√ß√£o de Contas Suspeitas** | Logs de Active Directory/LDAP, Logs de Auditoria de Sistema Operacional (Windows Event Logs - Security, Linux Auditd), Logs de SaaS/Cloud IAM. |
| **A.13.1.2 - Seguran√ßa dos servi√ßos de rede** | Acesso n√£o autorizado a servi√ßos de rede; Uso indevido de recursos de rede; Ataques DDoS. | **Detec√ß√£o de Anomalias de Tr√°fego de Rede e Acessos Incomuns** | Logs de Firewall, Routers, Switches, NetFlow/IPFIX, Logs de VPN, DNS.           |
| **A.16.1.4 - Monitoramento de incidentes de seguran√ßa da informa√ß√£o** | N√£o detec√ß√£o ou atraso na detec√ß√£o de incidentes de seguran√ßa; Resposta ineficaz a incidentes. | **Correla√ß√£o de Eventos e Gera√ß√£o de Alertas em Tempo Real** | Agrega todos os logs mencionados acima para correla√ß√£o, feeds de Threat Intelligence, Alertas de seguran√ßa de nuvem. |
| **A.15.1.1 - Pol√≠tica de seguran√ßa da informa√ß√£o para rela√ß√µes com fornecedores** | Acesso n√£o autorizado ou uso indevido de dados/sistemas por terceiros. | **Monitoramento de Acessos de Terceiros e Comportamento Anormal** | Logs de VPNs de parceiros, Logs de autentica√ß√£o de provedores de servi√ßos, Logs de acesso a dados compartilhados com fornecedores. |
| **A.14.2.1 - Pol√≠tica de desenvolvimento seguro** | Vulnerabilidades em aplica√ß√µes desenvolvidas internamente ou adquiridas. | **Monitoramento de Eventos de Seguran√ßa de Aplica√ß√µes** | Logs de WAF (Web Application Firewall), Logs de Auditoria de Aplica√ß√£o, Logs de autentica√ß√£o de aplica√ß√µes customizadas. |

# O que √© NOC?

**NOC** (Network Operations Center), ou Centro de Opera√ß√µes de Rede, √© uma unidade especializada respons√°vel pelo monitoramento, gerenciamento e manuten√ß√£o da infraestrutura de rede e sistemas de uma organiza√ß√£o.

## Objetivo do NOC

O principal objetivo do NOC √© garantir que a rede, servidores, aplica√ß√µes e demais componentes de TI estejam operando de forma est√°vel, segura e eficiente, minimizando o tempo de indisponibilidade e prevenindo falhas que possam afetar o neg√≥cio.

## Fun√ß√µes principais do NOC

- **Monitoramento cont√≠nuo:** acompanha o desempenho e a disponibilidade dos equipamentos e servi√ßos de rede 24/7.  
- **Detec√ß√£o e resposta a incidentes:** identifica rapidamente problemas, realiza diagn√≥sticos iniciais e aciona equipes de suporte para resolu√ß√£o.  
- **Gerenciamento de mudan√ßas:** controla atualiza√ß√µes, patches e configura√ß√µes para manter a rede segura e atualizada.  
- **Documenta√ß√£o e relat√≥rios:** mant√©m registros detalhados dos eventos, incidentes e a√ß√µes tomadas, auxiliando em an√°lises e auditorias.  
- **Coordena√ß√£o com outras equipes:** atua em conjunto com times de seguran√ßa (Blue Team), suporte t√©cnico e engenharia para garantir a integridade do ambiente.

## Import√¢ncia do NOC

Um NOC eficiente √© vital para assegurar a continuidade dos servi√ßos de TI, reduzindo riscos operacionais e garantindo que a organiza√ß√£o possa responder rapidamente a amea√ßas e falhas t√©cnicas.

---


# üîµ Fundamentos de Redes

Para atuar de forma eficaz na defesa cibern√©tica, um profissional Blue Team precisa compreender os **fundamentos das redes**. Esses conhecimentos s√£o essenciais para analisar tr√°fego, detectar comportamentos an√¥malos e identificar amea√ßas que se propagam pela rede.

A base de toda defesa √© entender como o tr√°fego leg√≠timo se comporta.

# üß± Modelo OSI ‚Äì A Estrutura da Comunica√ß√£o

Para entender como os dados trafegam em uma rede, √© essencial conhecer o **modelo OSI (Open Systems Interconnection)**.  
Ele divide a comunica√ß√£o em **7 camadas**, cada uma com responsabilidades espec√≠ficas. Isso facilita a an√°lise, o diagn√≥stico de problemas e a identifica√ß√£o de comportamentos maliciosos.

Esse modelo √© uma **base essencial para profissionais Blue Team**, pois permite compreender onde ocorrem ataques, falhas e desvios no tr√°fego.

---

## üß© As 7 Camadas do Modelo OSI

Cada camada desempenha uma fun√ß√£o no envio e recebimento de dados.  
Da **Camada 1 (F√≠sica)** at√© a **Camada 7 (Aplica√ß√£o)**, os dados s√£o processados, empacotados, transmitidos e interpretados.

| Camada | Nome                      | Fun√ß√£o Principal                                |
|--------|---------------------------|--------------------------------------------------|
| 7      | Aplica√ß√£o                 | Intera√ß√£o com o usu√°rio (HTTP, DNS, FTP)         |
| 6      | Apresenta√ß√£o              | Criptografia, compress√£o (TLS, JPEG)             |
| 5      | Sess√£o                    | Controle de sess√µes (RPC, NetBIOS)               |
| 4      | Transporte                | Controle de fluxo (TCP, UDP)                     |
| 3      | Rede                      | Roteamento e endere√ßamento (IP)                  |
| 2      | Enlace de Dados           | MAC, switches, detec√ß√£o de erros                 |
| 1      | F√≠sica                    | Cabos, sinais, hubs                              |

---

## üß† Como Pensar em Cada Camada

```
üü£ **Camada 7 ‚Äì Aplica√ß√£o**  
A interface entre o usu√°rio e a rede. Ex: navegadores, clientes de e-mail.

üîµ **Camada 6 ‚Äì Apresenta√ß√£o**  
Formata os dados. Pode criptografar (TLS) ou compactar (JPEG).

üü¢ **Camada 5 ‚Äì Sess√£o**  
Gerencia sess√µes entre aplica√ß√µes. Ex: login cont√≠nuo em servi√ßos.

üü° **Camada 4 ‚Äì Transporte**  
Respons√°vel pela entrega confi√°vel (TCP) ou r√°pida (UDP).

üü† **Camada 3 ‚Äì Rede**  
Decide o caminho que os pacotes ir√£o percorrer (roteamento via IP).

üî¥ **Camada 2 ‚Äì Enlace**  
Identifica dispositivos com endere√ßos MAC e garante entrega local.

‚ö´ **Camada 1 ‚Äì F√≠sica**  
Transmite bits atrav√©s de cabos, r√°dio ou fibra.
```

---

## üì° Modelo OSI na Pr√°tica

O modelo OSI √© uma **abstra√ß√£o**, mas tem grande valor pr√°tico. Ele permite que analistas:

- Diagnostiquem falhas (em que camada est√° o problema?)  
- Localizem ataques (ex: um DDoS na camada 4 ou 7)  
- Compreendam como ferramentas operam (Wireshark, IDS, firewalls)

---

## üõ°Ô∏è Relev√¢ncia para o Blue Team

Para o analista de defesa, entender o modelo OSI √© essencial para:

- Interpretar capturas de pacotes e logs  
- Detectar anomalias de tr√°fego em diferentes camadas  
- Criar regras de alerta com base em protocolos e comportamentos  
- Identificar ataques em camadas espec√≠ficas (ex: SQLi ‚Üí camada 7, ICMP ‚Üí camada 3)

Dominar o modelo OSI permite enxergar a rede de forma **estruturada e estrat√©gica**.



# üåê Endere√ßamento IP (IPv4)

O **endere√ßo IP (Internet Protocol)** √© o identificador √∫nico de um dispositivo em uma rede.  
Ele √© fundamental para o **roteamento, comunica√ß√£o e identifica√ß√£o de ativos**, sendo um conceito crucial para profissionais de ciberseguran√ßa.

O IPv4 √© a vers√£o mais utilizada e apresenta endere√ßos no formato **decimal com 4 octetos**, como `192.168.0.10`.

---

## üî¢ Estrutura de um IP

Um endere√ßo IPv4 possui **32 bits**, divididos em 4 blocos de 8 bits (octetos).

Exemplo:

```
IP: 192.168.0.10  
Bin√°rio: 11000000.10101000.00000000.00001010
```

A m√°scara de sub-rede (ex: `255.255.255.0`) determina **quantos bits pertencem √† rede** e **quantos ao host**.

---

## üß± Classes de IP

O IPv4 foi originalmente dividido em **classes**, embora hoje se use mais o conceito de sub-redes com CIDR (`/24`, `/16`, etc.).

| Classe | Intervalo Inicial     | Uso Comum                         |
|--------|------------------------|-----------------------------------|
| A      | 1.0.0.0 ‚Äì 126.255.255.255 | Grandes redes                     |
| B      | 128.0.0.0 ‚Äì 191.255.255.255 | Redes m√©dias                      |
| C      | 192.0.0.0 ‚Äì 223.255.255.255 | Pequenas redes                    |

---

## üè† IPs P√∫blicos e Privados

| Tipo   | Descri√ß√£o                                      | Exemplos                      |
|--------|------------------------------------------------|-------------------------------|
| üîí **Privado** | Usado dentro de redes internas               | `192.168.x.x`, `10.x.x.x`     |
| üåç **P√∫blico** | Usado para comunica√ß√£o externa (Internet) | Atribu√≠do por ISPs            |

IPs privados **n√£o s√£o rote√°veis pela internet**, e s√£o usados em redes locais com NAT.

---

## üìè M√°scara de Sub-rede

A **m√°scara** define o tamanho da rede e quantos IPs ela pode conter.

Exemplos:

| M√°scara           | CIDR  | IPs poss√≠veis (hosts) |
|-------------------|-------|------------------------|
| 255.255.255.0     | /24   | 254                    |
| 255.255.0.0       | /16   | 65.534                 |
| 255.0.0.0         | /8    | 16.777.214             |

---

## üß† CIDR ‚Äì Nota√ß√£o Simplificada

O **CIDR (Classless Inter-Domain Routing)** define a sub-rede com a nota√ß√£o `/n`, onde `n` √© o n√∫mero de bits da rede.

```
Exemplo:  
192.168.1.0/24  
‚û°Ô∏è 24 bits para a rede  
‚û°Ô∏è 8 bits para hosts (2‚Å∏ - 2 = 254 IPs utiliz√°veis)
```

---

## üõ°Ô∏è Relev√¢ncia para o Blue Team

Compreender o endere√ßamento IP permite:

- Identificar **ativos cr√≠ticos e suas redes**  
- Detectar tr√°fego **an√¥malo fora do escopo esperado**  
- Criar regras em **firewalls, SIEMs e IDS** com base em IPs ou sub-redes  
- Correlacionar eventos por origem/destino IP  
- Monitorar e isolar **sub-redes comprometidas**

Dominar IPv4 √© o primeiro passo para entender a movimenta√ß√£o dos dados na rede.



# üåê Protocolo DNS ‚Äì O Tradutor da Internet

O **DNS (Domain Name System)** √© um dos pilares da internet. Ele atua como um "tradutor", convertendo **nomes de dom√≠nio** (como `google.com`) em **endere√ßos IP** (como `142.250.190.78`), permitindo que os usu√°rios acessem sites de forma amig√°vel.

Para o Blue Team, o DNS √© uma **fonte valiosa de informa√ß√µes** ‚Äî tanto para detec√ß√£o de amea√ßas quanto para investiga√ß√£o de ataques em andamento.

---

## üß† Como o DNS Funciona?

Quando voc√™ acessa um site, o DNS segue uma **cadeia de resolu√ß√£o** at√© encontrar o IP correspondente ao nome:

1. Verifica o **cache local**  
2. Consulta o **servidor DNS recursivo**  
3. Passa por **servidores raiz**, **TLDs** (`.com`, `.org`, etc.)  
4. Chega ao **servidor autoritativo**, que responde com o IP

```
Exemplo:  
Voc√™ digita `chat.openai.com` ‚Üí o DNS retorna `104.18.12.123`  
```

---

## üìÑ Tipos de Registros DNS

| Tipo   | Nome                 | Finalidade                                  |
|--------|----------------------|----------------------------------------------|
| A      | Address              | IP IPv4 do dom√≠nio                           |
| AAAA   | IPv6 Address         | IP IPv6 do dom√≠nio                           |
| MX     | Mail Exchange        | Servidor de e-mail do dom√≠nio                |
| TXT    | Text                 | Informa√ß√µes adicionais (SPF, DKIM, verifica√ß√£o) |
| CNAME  | Canonical Name       | Apelido de outro dom√≠nio                     |
| NS     | Name Server          | Indica os servidores autoritativos           |
| PTR    | Pointer              | Usado em **resolu√ß√£o reversa**               |

---

## üîÑ Resolu√ß√£o Direta vs. Reversa

- **Resolu√ß√£o direta:** nome de dom√≠nio ‚Üí IP  
- **Resolu√ß√£o reversa:** IP ‚Üí nome de dom√≠nio (via registro **PTR**)  

Muito usada em auditorias, correla√ß√£o de logs e an√°lises forenses.

---

## üö® Ataques Comuns via DNS

| Ataque            | Descri√ß√£o                                                           |
|-------------------|----------------------------------------------------------------------|
| DNS Spoofing      | Resposta falsa com IP malicioso                                      |
| DNS Tunneling     | Comunica√ß√£o encoberta via requisi√ß√µes DNS                           |
| DNS Amplification | DDoS usando servidores DNS para refletir tr√°fego contra a v√≠tima     |

---

## üõ† Ferramentas de An√°lise

- `nslookup` ‚Äì consulta simples a registros  
- `dig` ‚Äì ferramenta avan√ßada de diagn√≥stico  
- **SIEMs** ‚Äì correlacionam padr√µes de requisi√ß√£o DNS suspeitos  
- **Wireshark** ‚Äì permite inspecionar pacotes DNS em profundidade  

---

## üõ°Ô∏è Relev√¢ncia para o Blue Team

Monitorar e analisar DNS permite ao analista:

- Detectar **comunica√ß√£o C2 encoberta via DNS tunneling**  
- Identificar **resolu√ß√µes suspeitas ou inesperadas**  
- Bloquear dom√≠nios maliciosos em **firewalls e proxies**  
- Correlacionar nomes de dom√≠nio com **IPs de origem/destino**  
- Investigar campanhas de **phishing** baseadas em dom√≠nios falsos

O DNS √© uma **mina de ouro para a defesa cibern√©tica** ‚Äî quando bem monitorado.



# üåê Protocolo HTTP/HTTPS ‚Äì A Base da Web

O **HTTP (Hypertext Transfer Protocol)** √© o protocolo usado para **comunica√ß√£o na web**. Ele permite que navegadores e servidores troquem informa√ß√µes ‚Äî como p√°ginas HTML, arquivos, imagens e APIs.

O **HTTPS** √© a vers√£o **segura** do HTTP, que utiliza **TLS (Transport Layer Security)** para proteger os dados durante a transmiss√£o.

Para o Blue Team, compreender o funcionamento do HTTP/HTTPS √© essencial para **monitorar tr√°fego web**, detectar **ataques via navegador** e proteger aplica√ß√µes web.

---

## üß± Estrutura de uma Requisi√ß√£o HTTP

Uma comunica√ß√£o HTTP b√°sica segue este padr√£o:

```
Cliente (navegador) envia:

GET /index.html HTTP/1.1  
Host: www.exemplo.com  
User-Agent: Mozilla/5.0  
Cookie: id=1234  

Servidor responde:

HTTP/1.1 200 OK  
Content-Type: text/html  
Set-Cookie: id=1234  
```

---

## üîß M√©todos HTTP Comuns

| M√©todo  | Finalidade                               |
|---------|-------------------------------------------|
| GET     | Solicita dados (sem corpo)                |
| POST    | Envia dados no corpo da requisi√ß√£o        |
| PUT     | Atualiza um recurso existente             |
| DELETE  | Remove um recurso                         |
| PATCH   | Atualiza parcialmente um recurso          |
| OPTIONS | Descobre m√©todos permitidos no endpoint   |

---

## üîÅ C√≥digos de Resposta

| C√≥digo | Significado               |
|--------|---------------------------|
| 200    | OK ‚Äì Requisi√ß√£o bem-sucedida       |
| 301    | Redirecionamento permanente         |
| 403    | Proibido ‚Äì sem permiss√£o            |
| 404    | N√£o encontrado                      |
| 500    | Erro interno do servidor            |

---

## üìé Cabe√ßalhos Importantes

Cabe√ßalhos HTTP s√£o usados para transmitir metadados nas requisi√ß√µes e respostas.

| Cabe√ßalho      | Fun√ß√£o                                         |
|----------------|------------------------------------------------|
| Host           | Indica o dom√≠nio do destino                    |
| User-Agent     | Identifica o cliente (navegador, app, etc.)    |
| Cookie         | Armazena dados de sess√£o ou rastreamento       |
| Referer        | Informa a origem da requisi√ß√£o                 |
| Content-Type   | Define o tipo de dado enviado (JSON, HTML...)  |

---

## üîê HTTPS ‚Äì Seguran√ßa com TLS

O **HTTPS** protege os dados com **criptografia TLS**, garantindo:

- Confidencialidade: ningu√©m pode ler o tr√°fego  
- Integridade: os dados n√£o s√£o alterados no caminho  
- Autenticidade: garante que o servidor √© leg√≠timo (via certificado)

```
Exemplo de URL segura:  
https://meusite.com  
‚û°Ô∏è Cadeado no navegador  
‚û°Ô∏è Tr√°fego criptografado com TLS  
```

---

## üö® Amea√ßas Relacionadas

- **Inje√ß√£o (SQLi, XSS):** via par√¢metros HTTP maliciosos  
- **Session hijacking:** roubo de cookies de sess√£o  
- **Phishing:** sites falsos com p√°ginas HTTP/HTTPS  
- **Exfiltra√ß√£o de dados:** via POST encoberto ou C2 web

---

## üõ°Ô∏è Relev√¢ncia para o Blue Team

Entender HTTP/HTTPS permite ao analista:

- Monitorar **requisi√ß√µes suspeitas** em aplica√ß√µes web  
- Identificar **tentativas de explora√ß√£o via payloads HTTP**  
- Criar **regras no SIEM** com base em cabe√ßalhos ou m√©todos  
- Analisar **logs de web servers** (Apache, Nginx, IIS)  
- Detectar **comunica√ß√£o com dom√≠nios maliciosos em HTTPS**

HTTP/HTTPS √© onde muito do tr√°fego leg√≠timo e malicioso passa ‚Äî por isso, √© um dos focos cr√≠ticos da defesa.



# üîÅ Protocolos TCP e UDP ‚Äì Transporte de Dados na Rede

Os protocolos **TCP** e **UDP** pertencem √† **Camada 4 (Transporte)** do modelo OSI.  
Eles s√£o respons√°veis por **entregar dados entre dispositivos** ‚Äî como sites, aplicativos, servidores e dispositivos IoT.

Embora ambos tenham o mesmo prop√≥sito geral (transporte), eles funcionam de maneiras **muito diferentes**, o que impacta diretamente na **an√°lise de tr√°fego e resposta a incidentes**.

---

## üß© TCP ‚Äì Transmission Control Protocol

O **TCP** √© um protocolo **confi√°vel e orientado √† conex√£o**. Ele garante que os dados cheguem completos e na ordem correta.

### üõ† Caracter√≠sticas:

- Garante entrega com **confirma√ß√£o de recebimento (ACK)**  
- Utiliza **controle de fluxo** e **retransmiss√£o** em caso de perda  
- Realiza o **three-way handshake** antes de transmitir dados

```
Etapas do Three-Way Handshake:

1Ô∏è‚É£ Cliente envia `SYN`  
2Ô∏è‚É£ Servidor responde com `SYN-ACK`  
3Ô∏è‚É£ Cliente responde com `ACK`  
‚û°Ô∏è Conex√£o estabelecida  
```

### üì¶ Aplica√ß√µes que usam TCP:

- HTTP / HTTPS  
- SSH  
- FTP  
- SMTP (e-mail)

---

## üß© UDP ‚Äì User Datagram Protocol

O **UDP** √© um protocolo **n√£o confi√°vel e sem conex√£o**.  
Ele **n√£o garante entrega**, mas √© **mais r√°pido e leve**.

### üõ† Caracter√≠sticas:

- Sem handshake nem confirma√ß√£o  
- Sem retransmiss√µes ou ordena√ß√£o  
- Ideal para aplica√ß√µes que toleram perdas e exigem baixa lat√™ncia

```
Exemplo:  
Enviar 100 pacotes UDP ‚Üí o receptor pode receber 95, sem erro.  
‚û°Ô∏è N√£o h√° aviso sobre perdas.
```

### üì¶ Aplica√ß√µes que usam UDP:

- DNS  
- DHCP  
- VoIP  
- Streaming de v√≠deo/√°udio  
- Jogos online

---

## ‚öñÔ∏è Comparativo TCP vs UDP

| Protocolo | Confiabilidade | Ordem dos dados | Velocidade | Uso comum                      |
|-----------|----------------|------------------|------------|-------------------------------|
| TCP       | ‚úÖ Sim         | ‚úÖ Garante       | üê¢ Mais lento | Web, e-mail, SSH              |
| UDP       | ‚ùå N√£o         | ‚ùå N√£o garante   | ‚ö° Mais r√°pido | Streaming, DNS, VoIP, jogos   |

---

## üß† Como o Blue Team Usa Isso

Saber **diferenciar TCP de UDP** √© fundamental para an√°lise de tr√°fego:

- Ataques como **SYN flood** afetam **TCP**  
- Exfiltra√ß√£o via **DNS tunneling** ocorre por **UDP**  
- Protocolos de C2 (comando e controle) podem usar **ambos**, dependendo da evas√£o  
- Firewalls e IDS aplicam **regras distintas para TCP e UDP**

---

## üõ°Ô∏è Relev√¢ncia para o Blue Team

Dominar os protocolos de transporte permite ao analista:

- Criar **regras mais precisas** em firewalls, SIEMs e IDS  
- Identificar **comunica√ß√£o maliciosa por portas incomuns**  
- Distinguir tr√°fego leg√≠timo de **an√°lise de portas (port scan)**  
- Monitorar **padr√µes de tr√°fego suspeitos** (ex: uso incomum de UDP)  
- Diagnosticar **problemas de entrega ou conectividade**

TCP e UDP s√£o a **base da comunica√ß√£o digital moderna** ‚Äî e do tr√°fego que o Blue Team precisa vigiar de perto.

# üì∂ ICMP ‚Äì O Protocolo da Comunica√ß√£o de Erros

O **ICMP (Internet Control Message Protocol)** √© um protocolo fundamental para a **comunica√ß√£o e diagn√≥stico de redes**. Embora n√£o transporte dados de aplica√ß√µes, ele √© essencial para identificar falhas, testar conex√µes e gerar alertas sobre problemas na entrega de pacotes.

Profissionais do **Blue Team** utilizam o ICMP para monitorar a sa√∫de da rede e detectar poss√≠veis tentativas de varredura ou movimenta√ß√£o lateral.

## üîç O que √© ICMP?

O ICMP faz parte do **protocolo IP**, operando na **Camada 3 (Rede)** do modelo OSI. Ele √© usado para:

- Enviar mensagens de **erro e controle**
- Indicar se um host est√° **dispon√≠vel ou n√£o**
- Sinalizar problemas como **rota inacess√≠vel**, **TTL excedido**, etc.

**Importante:** ICMP **n√£o usa portas**, diferente de TCP e UDP.

## üì° Tipos de Mensagens ICMP

As mensagens ICMP s√£o classificadas por **Tipo** e **C√≥digo**, e cada uma representa uma fun√ß√£o diferente.

| Tipo | Nome                      | Fun√ß√£o                                                    |
|------|---------------------------|------------------------------------------------------------|
| 0    | Echo Reply                | Resposta a um ping                                         |
| 3    | Destination Unreachable   | Destino inacess√≠vel                                        |
| 5    | Redirect Message          | Redirecionamento de rota                                   |
| 8    | Echo Request              | Requisi√ß√£o de ping                                         |
| 11   | Time Exceeded             | TTL excedido no caminho                                    |
| 13/14| Timestamp Request/Reply   | Sincroniza√ß√£o de hor√°rio                                   |

## üß™ Ferramentas que usam ICMP

O ICMP est√° presente em ferramentas de diagn√≥stico de rede como:

- `ping` ‚Äì Testa a conectividade com outro host  
- `traceroute` ‚Äì Mapeia o caminho at√© um destino (usando ICMP ou UDP)  
- `hping` ‚Äì Permite manipular pacotes ICMP para testes mais avan√ßados  

## üö® ICMP e Seguran√ßa

Apesar de leg√≠timo, o ICMP pode ser explorado por atacantes:

- **Ping Sweep:** escaneamento de hosts ativos  
- **ICMP Tunneling:** tunelamento de dados para evas√£o de firewall  
- **Flooding (DoS):** sobrecarga com mensagens ICMP (ex: Smurf Attack)

Por isso, √© comum filtrar ou limitar ICMP em **firewalls e roteadores**.

## üõ°Ô∏è Relev√¢ncia para o Blue Team

Dominar o ICMP ajuda o analista Blue Team a:

- Monitorar **disponibilidade de sistemas e redes**  
- Detectar **varreduras e movimenta√ß√µes maliciosas**  
- Criar **regras de alerta no SIEM** para mensagens ICMP suspeitas  
- Investigar falhas de **conectividade e roteamento**  
- Responder a incidentes relacionados a **DoS ou tunneling**


# ü§ù TCP Handshake ‚Äì Como a Conex√£o √© Estabelecida

O **TCP (Transmission Control Protocol)** √© um protocolo confi√°vel de transporte que garante a entrega de dados entre dois pontos.  
Antes de qualquer comunica√ß√£o, o TCP realiza um processo chamado **three-way handshake**, respons√°vel por **estabelecer uma conex√£o est√°vel**.

Profissionais Blue Team precisam entender esse processo para identificar comportamentos leg√≠timos e detectar **atividades suspeitas**, como **port scanning**, **spoofing** ou **tentativas de nega√ß√£o de servi√ßo**.

## üîÑ O que √© o Three-Way Handshake?

O **three-way handshake** √© o processo de tr√™s etapas usado para **iniciar uma conex√£o TCP** entre cliente e servidor.

Ele serve para:

- Sincronizar os n√∫meros de sequ√™ncia (SEQ)  
- Estabelecer par√¢metros da sess√£o  
- Confirmar que ambos os lados est√£o prontos para se comunicar

---

### üß≠ Etapas do Handshake

| Etapa | Origem     | Descri√ß√£o                                                                 |
|-------|------------|---------------------------------------------------------------------------|
| 1     | Cliente ‚Üí Servidor | Envia um **SYN** com seu n√∫mero de sequ√™ncia inicial (ex: SEQ = 1000)       |
| 2     | Servidor ‚Üí Cliente | Responde com **SYN-ACK** (ex: SEQ = 2000, ACK = 1001)                    |
| 3     | Cliente ‚Üí Servidor | Envia um **ACK** final (ACK = 2001), concluindo a conex√£o                  |

Ap√≥s isso, a sess√£o est√° aberta e os dados podem come√ßar a ser trocados.

---

### üì• Exemplo Visual

```
Cliente               Servidor
   | ---- SYN ------> |
   | <--- SYN-ACK --- |
   | ---- ACK ------> |
```

---

## üõ†Ô∏è An√°lise no Wireshark

Durante uma captura de tr√°fego, o three-way handshake pode ser identificado por:

- `Flags [S]` ‚Äì Pacote SYN  
- `Flags [S, ACK]` ‚Äì Resposta do servidor  
- `Flags [ACK]` ‚Äì Confirma√ß√£o do cliente  

Verificar os **n√∫meros de sequ√™ncia** e **tempo entre pacotes** pode revelar anomalias, como tentativas de **SYN flood** ou **spoofing**.

---

## üß® Amea√ßas Relacionadas

- **SYN Flood (DoS):** o atacante envia muitos SYNs sem completar o handshake  
- **Port Scanning:** ferramentas como `nmap` usam SYN para descobrir portas abertas  
- **Spoofing:** falsifica√ß√£o de IPs com pacotes SYN para burlar regras de firewall  

---

## üõ°Ô∏è Relev√¢ncia para o Blue Team

Compreender o handshake TCP permite ao analista:

- Detectar **tentativas de conex√£o maliciosas**  
- Criar regras no SIEM para **analisar conex√µes incompletas**  
- Responder a **ataques baseados em SYN flood**  
- Identificar **scans furtivos ou comunica√ß√£o an√¥mala**

A observa√ß√£o do handshake √© **fundamental em qualquer an√°lise de tr√°fego de rede**.

# Ferramentas de NOC (Network Operations Center)

No ambiente de um NOC, o uso de ferramentas eficientes √© fundamental para o monitoramento, gerenciamento e manuten√ß√£o da infraestrutura de rede e sistemas. A seguir, uma an√°lise das principais ferramentas usadas em NOCs: **Zabbix, Grafana, PHPIPAM e GLPI**.

---

## üõ†Ô∏è Zabbix

O **Zabbix** √© uma plataforma open-source para **monitoramento de redes, servidores, aplica√ß√µes e servi√ßos**.

### Caracter√≠sticas principais:

- Monitoramento em tempo real de disponibilidade e desempenho  
- Coleta de m√©tricas via agentes ou protocolos SNMP, IPMI, JMX, etc.  
- Sistema flex√≠vel de alertas e notifica√ß√µes configur√°veis  
- Dashboards e relat√≥rios personaliz√°veis  
- Suporte para monitoramento distribu√≠do e alta disponibilidade

### Uso no NOC:

Zabbix √© usado para detectar falhas e degrada√ß√£o na rede ou nos servidores, permitindo respostas r√°pidas e preven√ß√£o de downtime.

---

## üìä Grafana

O **Grafana** √© uma plataforma de an√°lise e visualiza√ß√£o de m√©tricas em tempo real, que se integra a diversas fontes de dados.

### Caracter√≠sticas principais:

- Dashboards interativos e altamente customiz√°veis  
- Suporte a v√°rias fontes de dados: Prometheus, InfluxDB, Elasticsearch, Zabbix, entre outros  
- Alertas configur√°veis baseados em regras definidas  
- Plugins para gr√°ficos, mapas de calor, tabelas e muito mais

### Uso no NOC:

Grafana √© amplamente utilizado para criar pain√©is visuais que facilitam a compreens√£o do estado da infraestrutura, complementando ferramentas de monitoramento como o Zabbix.

---

## üåê PHPIPAM

O **PHPIPAM** √© uma aplica√ß√£o web open-source para **gerenciamento de endere√ßamento IP (IPAM)**.

### Caracter√≠sticas principais:

- Invent√°rio e organiza√ß√£o de blocos IP, sub-redes e endere√ßos IP individuais  
- Suporte a VLANs, VRFs e hierarquias complexas de redes  
- Documenta√ß√£o de dispositivos e coment√°rios  
- Controle de acesso baseado em permiss√µes  
- API para integra√ß√£o com outras ferramentas

### Uso no NOC:

PHPIPAM ajuda o NOC a manter um controle preciso sobre os recursos de endere√ßamento IP, evitando conflitos e facilitando o planejamento e troubleshooting.

---

## üñ•Ô∏è GLPI

O **GLPI (Gestionnaire Libre de Parc Informatique)** √© um sistema de gerenciamento de recursos de TI e **central de servi√ßos (ITSM)**.

### Caracter√≠sticas principais:

- Invent√°rio autom√°tico e manual de hardware e software  
- Gest√£o de chamados (tickets) e fluxo de trabalho  
- Base de conhecimento para suporte  
- Controle de contratos, fornecedores e custos  
- Relat√≥rios e dashboards para an√°lise de desempenho

### Uso no NOC:

GLPI organiza e centraliza o suporte t√©cnico, facilitando a gest√£o dos incidentes, solicita√ß√µes e ativos, otimizando o trabalho do time de opera√ß√µes.

---

## Resumo

| Ferramenta | Fun√ß√£o Principal                      | Uso no NOC                                   |
|------------|-------------------------------------|----------------------------------------------|
| Zabbix     | Monitoramento de rede e sistemas    | Detectar falhas e performance em tempo real  |
| Grafana    | Visualiza√ß√£o de m√©tricas e dashboards| Pain√©is interativos para an√°lise visual       |
| PHPIPAM    | Gerenciamento de endere√ßamento IP   | Controle e planejamento de IPs e sub-redes   |
| GLPI       | Gest√£o de ativos e suporte t√©cnico   | Administra√ß√£o de chamados, invent√°rio e suporte |

---

Essas ferramentas, usadas em conjunto, permitem que o NOC mantenha a infraestrutura da rede saud√°vel, otimizada e com alta disponibilidade, al√©m de garantir agilidade no atendimento a incidentes.

## üîç Detec√ß√£o: Falha de login em massa
üìò Cen√°rio
Este cen√°rio corresponde √† detec√ß√£o de m√∫ltiplas falhas de autentica√ß√£o em um curto intervalo de tempo, o que pode indicar:

Tentativa de ataque de for√ßa bruta;

Execu√ß√£o de scripts automatizados tentando adivinhar credenciais;

Erros de configura√ß√£o que causam bloqueios constantes de contas.

Detectar esse comportamento √© essencial para antecipar a√ß√µes maliciosas e aplicar contra-medidas autom√°ticas.

üßæ Regra XML para o Wazuh

```
<group name="windows,authentication_failed,login_brute_force,"> <rule id="100001" level="10"> <if_sid>18107</if_sid> <field name="win.system.eventID">4625</field> <description>Detec√ß√£o de falha de login em massa - poss√≠vel for√ßa bruta</description> <group>authentication_failed,windows,</group> <frequency>5</frequency> <timeframe>60</timeframe> <same_source_ip /> <same_user /> <alert_by email="yes"/> <mitre> <id>T1110</id> <!-- Brute Force --> </mitre> </rule> </group>
```

‚öôÔ∏è Explica√ß√£o da Regra
Campo	Descri√ß√£o
if_sid 18107	Refere-se ao evento base 4625 (falha de login no Windows).
frequency 5	O alerta ser√° disparado se ocorrerem 5 falhas...
timeframe 60	...dentro de 60 segundos...
same_source_ip	...do mesmo endere√ßo IP de origem...
same_user	...e para o mesmo usu√°rio.
level 10	Alerta de alta criticidade.
mitre T1110	T√©cnica da matriz MITRE ATT&CK associada √† for√ßa bruta.

---
title: "Projeto: Gerenciamento de Informa√ß√µes e Eventos de Seguran√ßa (SIEM)"
date: 2025-06-26 16:30:00 -0300
categories: [Blue Team, Nivel 1]
tags: [Teorica]
description: "Profissional em in√≠cio de carreira, respons√°vel por monitoramento b√°sico, identifica√ß√£o preliminar de amea√ßas e suporte √†s opera√ß√µes de seguran√ßa. Atua seguindo procedimentos estabelecidos e orienta√ß√µes de profissionais mais experientes, desenvolvendo habilidades t√©cnicas e conhecimento do ambiente de seguran√ßa."
image:
  path: /assets/img/BlueTeamN1.png
  alt: Ilustra√ß√£o de um computador moderno com elementos de c√≥digo e processamento
---

# üîµ Blue Team: Introdu√ß√£o ao SIEM (conceito, uso, eventos)

Um dos principais aliados do Blue Team na detec√ß√£o de amea√ßas √© o **SIEM** ‚Äì uma ferramenta que centraliza, organiza e analisa eventos de seguran√ßa. Dominar o uso do SIEM √© essencial para prevenir, detectar e responder a incidentes em tempo real.

O SIEM √© o radar do Blue Team ‚Äì sem ele, voc√™ est√° voando √†s cegas.

## üß† O que √© um SIEM?

**SIEM** significa *Security Information and Event Management*.  
√â uma solu√ß√£o que coleta, armazena, correlaciona e analisa **eventos de seguran√ßa** gerados por dispositivos, sistemas e aplica√ß√µes.


## üéØ Objetivos principais do SIEM:

- **Centralizar logs** de diversos dispositivos (servidores, firewalls, endpoints, etc.)  
- **Detectar amea√ßas em tempo real** por meio de regras de correla√ß√£o  
- **Gerar alertas de seguran√ßa** baseados em comportamentos an√¥malos  
- **Apoiar investiga√ß√µes e resposta a incidentes**  
- **Cumprir requisitos de auditoria e conformidade**


## üóÇÔ∏è Fontes comuns de eventos no SIEM

Um SIEM pode receber eventos de praticamente qualquer sistema. Exemplos:

- **Windows:** eventos de logon (4624, 4625), cria√ß√£o de processo (4688)  
- **Linux:** logs de autentica√ß√£o (`/var/log/auth.log`), sudo, SSH  
- **Firewalls:** conex√µes permitidas/bloqueadas, NAT, regras violadas  
- **EDR/Antiv√≠rus:** detec√ß√£o de malware, execu√ß√£o suspeita  
- **Servi√ßos em nuvem:** AWS CloudTrail, Azure Monitor, Google Cloud Logging  
- **Aplica√ß√µes:** falhas de autentica√ß√£o, a√ß√µes cr√≠ticas de usu√°rios  


## üîç Exemplo de evento no SIEM (Windows)

```json
{
  "EventID": 4625,
  "AccountName": "admin",
  "LogonType": 3,
  "IPAddress": "10.10.10.15",
  "Status": "0xC000006A",
  "TimeCreated": "2025-06-26T22:15:00"
}
```

Esse evento indica uma **tentativa de logon falha** em uma conex√£o de rede (tipo 3), vinda do IP `10.10.10.15`.


## ‚öôÔ∏è Como o SIEM funciona (fluxo geral)

1. **Coleta:** agentes ou forwarders enviam logs dos dispositivos  
2. **Normaliza√ß√£o:** dados brutos s√£o estruturados em um formato comum  
3. **Indexa√ß√£o:** eventos s√£o armazenados para consulta r√°pida  
4. **Correla√ß√£o:** regras detectam padr√µes de ataque ou anomalias  
5. **Alerta:** notifica√ß√µes s√£o geradas com base nas regras  
6. **An√°lise:** analistas investigam eventos por meio de dashboards e buscas  
7. **Resposta:** a√ß√µes manuais ou autom√°ticas s√£o iniciadas


## üìå Exemplos de uso pr√°tico no Blue Team

- Detectar **tentativas de brute-force** com m√∫ltiplos eventos 4625  
- Identificar **movimenta√ß√£o lateral** por logons RDP fora do padr√£o  
- Monitorar **execu√ß√µes de comandos perigosos** (ex: PowerShell + base64)  
- Correlacionar logs de firewall com eventos de endpoint  
- Criar alertas baseados em **hor√°rios an√¥malos de login** ou **usu√°rios privilegiados**


## üõ†Ô∏è Exemplos de ferramentas SIEM

| Nome         | Tipo        | Coment√°rio                                 |
|--------------|-------------|--------------------------------------------|
| **Splunk**   | Comercial   | Muito robusto, flex√≠vel e escal√°vel        |
| **ELK Stack**| Open-source | Elastic + Logstash + Kibana                |
| **Wazuh**    | Open-source | SIEM com foco em seguran√ßa e compliance    |
| **Microsoft Sentinel** | Cloud | Integrado ao Azure, f√°cil de automatizar |
| **Graylog**  | Open-source | Interface simples e eficaz                 |


## üß† Dica para iniciantes:

Comece aprendendo a **buscar eventos espec√≠ficos**, como:

- `EventID=4625` ‚Üí logons falhos  
- `cmd.exe` OU `powershell.exe` ‚Üí execu√ß√£o de comandos  
- `src_ip:10.0.0.* AND dst_port:3389` ‚Üí acessos RDP

Aos poucos, avance para **regras de correla√ß√£o personalizadas**, alertas automatizados e uso de dashboards.

# üîµ Blue Team: Treinamento ‚Äì Splunk Fundamentals 1 (M√≥dulos 1 e 2)

O curso **Splunk Fundamentals 1** √© a porta de entrada oficial para o uso do Splunk, uma das ferramentas de SIEM mais poderosas do mercado. Os **m√≥dulos 1 e 2** apresentam os conceitos b√°sicos de uso da plataforma, essenciais para analistas de Blue Team.

Buscar √© o novo modo de investigar ‚Äì e no Splunk, a linguagem √© poder.

## üéØ Objetivo do curso

Capacitar o aluno a navegar pela interface do Splunk, executar buscas b√°sicas, usar comandos essenciais e compreender a estrutura dos dados.  

O conte√∫do √© gratuito e online, dispon√≠vel na [Splunk Education](https://www.splunk.com/en_us/training.html).

## üìò M√≥dulo 1 ‚Äì Introdu√ß√£o ao Splunk

### üîπ O que √© Splunk?

O Splunk √© uma plataforma que permite coletar, indexar, pesquisar, visualizar e correlacionar dados de qualquer fonte (logs, m√©tricas, eventos). Ele √© amplamente utilizado para:

- Monitoramento de seguran√ßa (SIEM)  
- Observabilidade de sistemas  
- Resposta a incidentes  
- Detec√ß√£o de amea√ßas  

### üß± Componentes principais:

- **Indexer:** onde os dados s√£o armazenados e indexados  
- **Search Head:** onde o usu√°rio faz buscas e visualiza√ß√µes  
- **Forwarder:** envia dados para o Indexer  
- **Deployment Server:** gerencia configura√ß√µes em larga escala  

### üß≠ Navegando pela interface:

- **Search & Reporting:** painel principal de buscas  
- **Data Summary:** visualiza hosts, fontes e tipos de dados  
- **Apps:** m√≥dulos adicionais como Enterprise Security  
- **Settings:** configura√ß√µes de dados, usu√°rios e permiss√µes  

## üìò M√≥dulo 2 ‚Äì Executando Buscas no Splunk

### üîé Sintaxe b√°sica de busca:

As buscas no Splunk come√ßam com a palavra `search` (opcional) e utilizam filtros por palavras-chave, campos e comandos.  

**Exemplo simples:**

```spl
index=main error
```

Retorna eventos no √≠ndice `main` que contenham a palavra "error".


### üóÉÔ∏è Filtros comuns:

- `index=` ‚Üí especifica qual √≠ndice de dados usar  
- `source=` ‚Üí arquivo ou origem dos dados  
- `sourcetype=` ‚Üí tipo de dado (ex: `WinEventLog:Security`)  
- `host=` ‚Üí hostname de onde veio o log  

**Exemplo:**

```spl
index=ossec source="/var/log/auth.log" action=denied
```

### üß† Dica: Usar o bot√£o **"Data Summary"** para descobrir os √≠ndices, fontes e tipos mais usados antes de buscar.

### üìä Visualiza√ß√µes b√°sicas:

Ap√≥s executar uma busca, o Splunk permite criar gr√°ficos a partir dos resultados com comandos como:

```spl
index=firewall action=blocked | stats count by src_ip
```
Esse comando conta quantas vezes cada IP de origem foi bloqueado.


### üîß Operadores √∫teis:

| Operador     | Descri√ß√£o                         |
|--------------|-----------------------------------|
| `AND`        | Ambos os termos devem existir     |
| `OR`         | Um ou outro pode existir          |
| `NOT`        | Exclui eventos com esse termo     |
| `=`          | Busca por campo igual a valor     |
| `!=`         | Campo diferente do valor          |

## üß† Para praticar:

- Use os **datasets de demonstra√ß√£o** dispon√≠veis na inst√¢ncia Splunk do curso  
- Crie buscas simples por falhas de login, comandos executados ou IPs suspeitos  
- Experimente filtros com `index=`, `source=`, `sourcetype=`, `host=`

## üöÄ Pr√≥ximos m√≥dulos

Nos m√≥dulos seguintes, o curso aborda:

- Uso avan√ßado do `stats`, `table`, `timechart`  
- Cria√ß√£o de dashboards  
- Alertas e relat√≥rios programados  

# üîµ Blue Team: Treinamento ‚Äì Splunk Fundamentals 1 (M√≥dulos 3 e 4)

Dando continuidade ao treinamento oficial **Splunk Fundamentals 1**, os m√≥dulos 3 e 4 aprofundam o uso da linguagem de busca do Splunk, introduzindo **campos, visualiza√ß√µes, estat√≠sticas e comandos avan√ßados**. S√£o fundamentais para analistas de seguran√ßa que desejam criar investiga√ß√µes mais precisas e dashboards informativos.

Comandos como `stats` e `eval` transformam o analista de observador em investigador.

## üìò M√≥dulo 3 ‚Äì Usando Campos no Splunk

### üìå O que s√£o Campos?

Campos s√£o pares **chave:valor** extra√≠dos dos eventos (como `src_ip=10.0.0.1`, `status=404`).  
O Splunk **detecta automaticamente** campos comuns, mas voc√™ pode **criar, filtrar e manipular** campos conforme necess√°rio.

### üîç Usando campos em buscas

Voc√™ pode usar campos diretamente para refinar resultados:

```spl
index=web sourcetype=access_combined status=404
```

Isso retorna apenas eventos onde o status da requisi√ß√£o HTTP √© 404.

### üîß Campos personalizados (rex, eval)

Voc√™ pode criar novos campos tempor√°rios durante a busca:

#### üìå `eval` ‚Üí Cria campos com l√≥gica simples

```spl
... | eval risco=if(status==500, "alto", "baixo")
```

#### üìå `rex` ‚Üí Extrai campos usando express√µes regulares

```spl
... | rex field=_raw "user=(?<username>\w+)"
```

Esse exemplo cria um campo chamado `username` extra√≠do do conte√∫do de `_raw`.

### üß∞ Comando `fields`

Usado para **mostrar ou ocultar** campos no resultado:

```spl
... | fields username, src_ip
```

## üìò M√≥dulo 4 ‚Äì Usando Estat√≠sticas e Visualiza√ß√µes

### üìä Comando `stats`

O `stats` permite agregar dados e gerar resumos estat√≠sticos.  
Exemplo: contar eventos por endere√ßo IP:

```spl
index=firewall action=blocked | stats count by src_ip
```

### üìä Outros comandos estat√≠sticos:

| Comando          | Fun√ß√£o                          |
|------------------|----------------------------------|
| `count`          | Conta eventos                   |
| `sum`            | Soma valores num√©ricos          |
| `avg`            | M√©dia                           |
| `min` / `max`    | M√≠nimo / M√°ximo                 |
| `dc`             | Distinct count (valores √∫nicos) |

### üßÆ Exemplo com m√∫ltiplas m√©tricas:

```spl
index=web status=* | stats count, dc(clientip) by status
```

Conta o n√∫mero total de eventos e o n√∫mero de IPs √∫nicos por status HTTP.


### üìà Visualiza√ß√µes no Splunk

Voc√™ pode transformar buscas em **gr√°ficos interativos**, como:

- **Barras** (por quantidade)  
- **Pizza** (por distribui√ß√£o)  
- **Linha do tempo** (eventos ao longo do tempo)  
- **Mapa geogr√°fico** (com dados de localiza√ß√£o)  

#### Exemplo com `timechart`:

```spl
index=web status=200 | timechart count by host
```

Mostra quantos eventos 200 ocorreram ao longo do tempo, por host.

### üìã Comando `table`

Mostra os dados em forma de tabela personalizada:

```spl
index=auth action=failure | table _time, user, src_ip
```

## ‚úÖ Dicas pr√°ticas:

- Combine `stats`, `eval`, `table` e `fields` para criar visualiza√ß√µes ricas  
- Use `timechart` para an√°lises temporais (com base em `_time`)  
- Utilize `dc(field)` para identificar **diversidade** de valores, √∫til em an√°lise de comportamento  
- Evite usar `search *` (buscas amplas demais)

## üß† Exemplo de caso real:

> "Queremos descobrir os 10 IPs que mais geraram falhas de autentica√ß√£o nos √∫ltimos 7 dias."

Busca poss√≠vel:

```spl
index=auth action=failure | stats count by src_ip | sort - count | head 10
```

# üîµ Blue Team: Estudo de Casos ‚Äì Alertas Comuns em SOC

Um SOC (Security Operations Center) monitora constantemente eventos em tempo real com base em **alertas autom√°ticos**. Esses alertas s√£o essenciais para identificar atividades suspeitas, amea√ßas ou viola√ß√µes em andamento.

Este estudo de caso apresenta **exemplos reais de alertas comuns**, especialmente √∫teis para analistas de Blue Team iniciantes e intermedi√°rios.

Alertas n√£o servem para gritar, mas para informar com intelig√™ncia.

## üö® 1. Tentativas de Brute-force

### üéØ Objetivo:
Detectar **m√∫ltiplas falhas de autentica√ß√£o** em um curto per√≠odo de tempo.

### üß† L√≥gica do alerta:
- Muitos eventos de falha de login (Windows Event ID 4625)  
- Mesma origem IP ou mesmo usu√°rio  
- Curto intervalo de tempo

### üïµÔ∏è Exemplo em Splunk:

```spl
index=wineventlog EventCode=4625 
| stats count by src_ip, user 
| where count > 10
```

Esse alerta detecta IPs ou usu√°rios com mais de 10 falhas de login.

## üö® 2. Execu√ß√£o de Comandos Suspeitos

### üéØ Objetivo:
Identificar execu√ß√µes de comandos ou scripts potencialmente perigosos.

### üß† L√≥gica do alerta:
- Detec√ß√£o de `cmd.exe`, `powershell.exe`, `wscript.exe`  
- Comandos com uso de `base64`, `invoke`, `download`, `encodedcommand`

### üïµÔ∏è Exemplo em Splunk:

```spl
index=windows EventCode=4688 
| where CommandLine LIKE "%powershell%" AND CommandLine LIKE "%base64%"
```

Esse alerta flagra o uso de PowerShell com codifica√ß√£o base64 (comum em malware).

## üö® 3. Novo Usu√°rio Criado em Hor√°rio Incomum

### üéØ Objetivo:
Detectar cria√ß√£o de contas suspeitas fora do hor√°rio comercial.

### üß† L√≥gica do alerta:
- Event ID 4720 (novo usu√°rio)  
- Hor√°rio entre 00:00 e 06:00

### üïµÔ∏è Exemplo em Splunk:

```spl
index=wineventlog EventCode=4720 
| eval hour=strftime(_time,"%H") 
| where hour < 6
```

Esse alerta aponta cria√ß√µes de usu√°rio entre meia-noite e 6h da manh√£.

## üö® 4. Atividade Remota N√£o Comum (ex: RDP fora do padr√£o)

### üéØ Objetivo:
Detectar conex√µes remotas an√¥malas ou fora do pa√≠s esperado.

### üß† L√≥gica do alerta:
- Logons via RDP (LogonType=10)  
- Pa√≠s/IP fora do perfil da empresa

### üïµÔ∏è Exemplo:

```spl
index=wineventlog EventCode=4624 LogonType=10 
| iplocation src_ip 
| search Country!="Brazil"
```

Esse alerta detecta acessos RDP de fora do pa√≠s.

## üö® 5. Execu√ß√£o de Bin√°rios Raros (Living off the Land)

### üéØ Objetivo:
Detectar o uso de bin√°rios do sistema que podem ser abusados (LOLBins).

### ‚ö†Ô∏è Exemplos:
- `mshta.exe`, `certutil.exe`, `regsvr32.exe`, `rundll32.exe`

### üïµÔ∏è Exemplo de alerta:

```spl
index=windows EventCode=4688 
| search NewProcessName IN ("*mshta.exe", "*certutil.exe", "*regsvr32.exe")
```

Esses processos s√£o frequentemente usados em ataques fileless.

## üõ°Ô∏è Dicas de Blue Team:

- Automatize esses alertas via SIEM para resposta r√°pida  
- Crie **baselines normais** para comparar com desvios  
- Utilize blocos como `threat_intel`, `lookup`, `geoip` para enriquecer alertas  
- Combine logs de endpoints, rede e identidade para mais precis√£o

## ‚úÖ Conclus√£o

Dominar alertas comuns permite que o analista:

- üïí Ganhe agilidade na triagem de incidentes  
- üö© Reduza falsos positivos com ajustes finos  
- üìà Fortale√ßa regras com base em observa√ß√µes reais  
- üí° Evolua o SOC para um modelo mais inteligente e preditivo

# üîµ Blue Team: Simula√ß√£o com ELK Stack ‚Äì Ingest√£o de Logs e Buscas

O **ELK Stack** (Elasticsearch, Logstash e Kibana) √© uma das ferramentas mais usadas para centraliza√ß√£o de logs, buscas e visualiza√ß√µes em ambientes de seguran√ßa.  
Essa simula√ß√£o mostra como fazer uma ingest√£o b√°sica de logs e executar buscas √∫teis para o Blue Team.

Com ELK, at√© um simples log do sistema se transforma em intelig√™ncia de seguran√ßa.

## üì¶ O que √© o ELK Stack?

- **Elasticsearch:** mecanismo de busca e armazenamento dos dados indexados  
- **Logstash:** pipeline de coleta, transforma√ß√£o e envio de logs  
- **Kibana:** interface web para visualiza√ß√£o e an√°lise dos dados  

## üõ†Ô∏è Ambiente da simula√ß√£o

- ELK local ou via Docker  
- Logstash configurado para receber logs de arquivos locais (ex: `/var/log/auth.log`)  
- Kibana acess√≠vel em `http://localhost:5601`  
- Logs simulados de Linux e autentica√ß√£o

## üì• Etapa 1 ‚Äì Ingest√£o de logs com Logstash

O Logstash utiliza um **pipeline** com tr√™s se√ß√µes: `input`, `filter` e `output`.

### üìÑ Exemplo de pipeline (`logstash.conf`):

```bash
input {
  file {
    path => "/var/log/auth.log"
    start_position => "beginning"
  }
}

filter {
  grok {
    match => { "message" => "%{SYSLOGTIMESTAMP:timestamp} %{HOSTNAME:host} sshd.*Failed password for %{USER:user} from %{IP:src_ip}" }
  }
}

output {
  elasticsearch {
    hosts => ["http://localhost:9200"]
    index => "linux-auth"
  }
  stdout { codec => rubydebug }
}
```

Esse pipeline l√™ falhas de login SSH e envia para o √≠ndice `linux-auth`.

## üìä Etapa 2 ‚Äì Visualizando no Kibana

1. Acesse o **Kibana** em `http://localhost:5601`  
2. V√° em **Stack Management > Index Patterns**  
3. Crie um padr√£o com o √≠ndice `linux-auth*`  
4. V√° em **Discover** para ver os eventos em tempo real

## üîç Etapa 3 ‚Äì Buscas √∫teis para Blue Team

### ‚ùó Falhas de login SSH

```kibana
message: "Failed password"
```

### üìà Quantidade de falhas por IP

```kibana
message: "Failed password"
| stats count by src_ip
```

### üîé IPs com m√∫ltiplas tentativas

```kibana
message: "Failed password"
| stats count by src_ip
| where count > 5
```

### ‚è±Ô∏è Tentativas fora do hor√°rio comercial

```kibana
message: "Failed password"
| eval hour = date_format(timestamp, "H")
| where hour < 6 OR hour > 20
```

> As buscas no Kibana podem ser feitas com filtros simples ou usando **Lens** e **Visualize** para dashboards.

## üß† Dicas pr√°ticas:

- Use **grok** para estruturar logs sem formata√ß√£o (ex: logs brutos do Linux)  
- Configure **alertas** com o Kibana Alerts (Watcher) ou Elastic Security  
- Combine com **beats** (ex: Filebeat) para facilitar a coleta de logs remotos  
- Visualize falhas e sucessos de login, execu√ß√µes de comando e mudan√ßas de usu√°rios

## ‚úÖ Conclus√£o

Com o ELK Stack, √© poss√≠vel construir uma solu√ß√£o poderosa e gratuita para:

- Centralizar logs de servidores, firewalls e endpoints  
- Investigar tentativas de intrus√£o em tempo real  
- Criar alertas e relat√≥rios automatizados  
- Apoiar investiga√ß√µes forenses com base hist√≥rica

# üîµ Blue Team: Estudo de Logs em SIEM (Sysmon, DNS, Proxy, Endpoint)

O sucesso da an√°lise de seguran√ßa no SIEM depende da **qualidade dos logs** que ele recebe. Para que o Blue Team consiga detectar comportamentos suspeitos e responder a incidentes de forma eficaz, √© essencial compreender os principais tipos de log e o que cada um pode revelar.

Este guia cobre os logs mais importantes no contexto de um SIEM: **Sysmon, DNS, Proxy e Endpoint**.

Quem domina os logs, controla a narrativa de um incidente.

---

## üß† O que √© log no contexto de SIEM?

Logs s√£o registros de atividades geradas por sistemas, aplicativos, dispositivos de rede e endpoints. O SIEM coleta, indexa e correlaciona esses eventos para:

- Identificar comportamentos an√¥malos
- Gerar alertas de seguran√ßa
- Ajudar na resposta a incidentes
- Facilitar investiga√ß√µes forenses

---

## üõ†Ô∏è 1. Sysmon (System Monitor)

O Sysmon √© uma ferramenta da Microsoft que registra eventos detalhados sobre o sistema operacional. Ele √© instalado como um servi√ßo e produz logs no canal de eventos do Windows.

### Eventos relevantes no SIEM:

| Event ID | Descri√ß√£o                            |
|----------|--------------------------------------|
| 1        | Cria√ß√£o de processo                  |
| 3        | Conex√£o de rede                      |
| 7        | Cria√ß√£o de imagem carregada (DLLs)   |
| 11       | Cria√ß√£o de arquivo                   |
| 13       | Modifica√ß√£o de chave do Registro     |

### Utiliza√ß√£o pr√°tica:

- Identificar execu√ß√£o de PowerShell suspeito
- Detectar movimenta√ß√£o lateral via processos remotos
- Mapear conex√µes de rede iniciadas por malware

---

## üåê 2. Logs de DNS

Os logs de DNS mostram quais dom√≠nios foram consultados por sistemas e usu√°rios, funcionando como uma janela para os alvos de comunica√ß√£o na rede.

### Dados comuns em logs DNS:

- Nome do dom√≠nio consultado
- IP de origem (host)
- Timestamp da requisi√ß√£o
- Resposta do servidor

### Utiliza√ß√£o pr√°tica:

- Detectar conex√µes com dom√≠nios maliciosos (C2, phishing)
- Identificar tunneling de dados via DNS
- Criar listas de bloqueio a partir de IOCs

---

## üåç 3. Logs de Proxy

Proxies interceptam o tr√°fego web, e seus logs s√£o ricos em dados de navega√ß√£o. Um SIEM bem alimentado com logs de proxy √© fundamental para monitorar acesso a conte√∫do suspeito.

### Campos √∫teis:

- URL acessada
- M√©todo HTTP (GET, POST, etc.)
- C√≥digo de resposta (200, 403, etc.)
- IP/usu√°rio de origem
- Volume de dados trafegado

### Utiliza√ß√£o pr√°tica:

- Detectar acesso a dom√≠nios suspeitos ou proibidos
- Identificar comportamento an√¥malo de navega√ß√£o
- Correlacionar usu√°rios com exfiltra√ß√£o de dados

---

## üíª 4. Logs de Endpoint (EDR/Antiv√≠rus)

Os endpoints s√£o a linha de frente contra amea√ßas. Ferramentas de EDR (como CrowdStrike, SentinelOne, Defender for Endpoint) geram eventos sobre comportamento de processos, arquivos, usu√°rios e rede.

### Tipos de eventos:

- Execu√ß√£o de bin√°rios
- Acesso/modifica√ß√£o de arquivos
- Detec√ß√£o de malware
- Eleva√ß√£o de privil√©gios
- Persist√™ncia suspeita

### Utiliza√ß√£o pr√°tica:

- Detectar ransomware ou execu√ß√£o de scripts automatizados
- Correlacionar a√ß√µes maliciosas com o usu√°rio respons√°vel
- Monitorar atividade p√≥s-comprometimento

---

## üß© Correlacionando logs no SIEM

O verdadeiro poder de um SIEM est√° na correla√ß√£o entre fontes diferentes. Por exemplo:

- Sysmon registra a execu√ß√£o de `powershell.exe`
- DNS mostra conex√£o com dom√≠nio suspeito
- Proxy indica upload para servi√ßo externo
- Endpoint alerta para comportamento an√¥malo do processo

Essa sequ√™ncia pode indicar exfiltra√ß√£o de dados via PowerShell e DNS tunneling.

---

## ‚úÖ Conclus√£o

Um bom analista de Blue Team precisa dominar a leitura e interpreta√ß√£o dos logs mais comuns em ambientes corporativos. Entender o **contexto** e o **valor anal√≠tico** de cada tipo de log permite criar alertas eficazes, acelerar investiga√ß√µes e melhorar a postura defensiva da organiza√ß√£o.

# Instala√ß√£o de ambiente Wazuh

Bem-vindo √† se√ß√£o dedicada √† instala√ß√£o do Wazuh em um ambiente de produ√ß√£o. Esta parte detalhar√° os passos necess√°rios para configurar um sistema robusto e escal√°vel, garantindo a coleta e an√°lise eficiente de logs para detec√ß√£o de amea√ßas e conformidade.

---

### **1. Planejamento da Arquitetura**

* **Requisitos de Hardware/VM:** Dimensionamento para o ambiente de produ√ß√£o (CPU, RAM, Armazenamento - SSD/NVMe preferencial para Elasticsearch/OpenSearch).
* **Topologia de Rede:** Considera√ß√µes sobre firewalls, DMZ, sub-redes para managers, indexers e dashboards.
* **Escalabilidade:** Discuss√£o sobre arquiteturas distribu√≠das (separa√ß√£o de Manager, Indexer, Dashboard) versus all-in-one para ambientes menores.
* **Sistemas Operacionais Suportados:** Escolha do SO para cada componente (ex: CentOS, Ubuntu, Debian).

---

### **2. Pr√©-requisitos e Prepara√ß√£o do Ambiente**

* **Configura√ß√£o de Rede:** Endere√ßamento IP est√°tico, resolu√ß√£o de DNS.
* **Ajustes do Sistema Operacional:** Otimiza√ß√£o de par√¢metros do kernel (ex: `vm.max_map_count`), limites de arquivos abertos (ulimit).
* **Instala√ß√£o de Pacotes Essenciais:** Ferramentas como `wget`, `curl`, `apt-transport-https`.
* **Configura√ß√£o de Firewall (Host-based):** Abertura das portas necess√°rias para a comunica√ß√£o entre os componentes Wazuh (80/443, 1514, 55000, 9200, 5601, etc.).

---

### **3. Instala√ß√£o dos Componentes do Wazuh**

Esta se√ß√£o ser√° dividida de acordo com a arquitetura escolhida (ex: All-in-one, Distributed).

#### **3.1. Wazuh Indexer (anteriormente Elasticsearch)**

* **Instala√ß√£o de Java (JDK).**
* **Adi√ß√£o do reposit√≥rio Wazuh.**
* **Instala√ß√£o e configura√ß√£o do Wazuh Indexer:**
    * Gera√ß√£o e distribui√ß√£o de certificados SSL (fundamental para produ√ß√£o!).
    * Configura√ß√£o de clusters (para ambientes distribu√≠dos).
    * Otimiza√ß√µes de performance.

#### **3.2. Wazuh Manager**

* **Adi√ß√£o do reposit√≥rio Wazuh.**
* **Instala√ß√£o e configura√ß√£o do Wazuh Manager:**
    * Conex√£o com o Wazuh Indexer (via certificados).
    * Configura√ß√£o de regras e decodificadores personalizados (se aplic√°vel).
    * Ajustes de capacidade de agentes.

#### **3.3. Wazuh Dashboard (anteriormente Kibana)**

* **Adi√ß√£o do reposit√≥rio Wazuh.**
* **Instala√ß√£o e configura√ß√£o do Wazuh Dashboard:**
    * Integra√ß√£o com o Wazuh Indexer e Manager.
    * Configura√ß√£o de acesso HTTPS.
    * Cria√ß√£o de usu√°rios e roles.

---

### **4. Configura√ß√µes P√≥s-Instala√ß√£o e Seguran√ßa**

* **Gera√ß√£o de Agentes:** Como registrar e implantar agentes nas m√°quinas monitoradas.
* **Hardening:** Melhores pr√°ticas de seguran√ßa para os servidores Wazuh (desabilitar servi√ßos n√£o utilizados, etc.).
* **Backup e Recupera√ß√£o:** Estrat√©gias para backup dos dados do Indexer e configura√ß√µes do Manager.
* **Monitoramento da Sa√∫de do Sistema:** Como verificar o status dos servi√ßos e recursos.

---

### **5. Resolu√ß√£o de Problemas Comuns**

* Uma se√ß√£o dedicada a erros frequentes e suas solu√ß√µes.

---

### Casos de Uso SIEM

| Nome da regra                                   | Categoria base Mitre                               | Tecnologia aplicada                                   | Como testar                                                                                                                              |
| :---------------------------------------------- | :------------------------------------------------- | :------------------------------------------------------ | :--------------------------------------------------------------------------------------------------------------------------------------- |
| Tentativas M√∫ltiplas de Login Falhas (Brute Force) | Initial Access (T1078) / Credential Access (T1110) | Logs de Autentica√ß√£o (Active Directory, Linux Auth Logs, Aplica√ß√µes Web, VPN) | Tentar m√∫ltiplos logins inv√°lidos em uma conta por ferramentas como Hydra ou scripts (em ambiente controlado).                           |
| Login de Localiza√ß√£o Geogr√°fica Incomum         | Initial Access (T1078) / Defense Evasion (T1564)   | Logs de Login (VPN, Cloud Services - O365, Azure AD, GSuite) | Usar uma VPN para simular login de um pa√≠s diferente do usual para um servi√ßo de nuvem.                                                   |
| Grande Volume de Dados Transferidos (Exfiltra√ß√£o) | Exfiltration (T1041, T1048, T1537)                 | Logs de Proxy/Firewall (Web Proxy, Firewall, DLP), Logs de Cloud Storage (S3, Azure Blob) | Transferir um arquivo grande para um servi√ßo de armazenamento em nuvem n√£o autorizado ou para um IP externo.                              |
| Cria√ß√£o/Modifica√ß√£o de Conta Privilegiada Suspeita | Privilege Escalation (T1078, T1098, T1136)          | Logs de Auditoria de SO (Windows Event Logs - Security, Linux Auditd), Logs de Active Directory/LDAP | Tentar adicionar uma conta a um grupo de administradores ou modificar permiss√µes de um arquivo cr√≠tico (em ambiente de teste).           |
| Conex√£o Suspeita para IP Malicioso Conhecido    | Command and Control (T1071, T1573) / Execution (T1204) | Logs de DNS, Logs de Firewall/Proxy, Threat Intelligence Feeds | Tentar acessar um dom√≠nio conhecido por ser malicioso (de uma lista de TI) em um ambiente controlado, ou simular uma conex√£o C2 simples. |